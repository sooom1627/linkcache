# Swipe Triage Implementation Roadmap (Vertical Slicing)

プロジェクトの核心である「Swipe Triage」を、ユーザーが価値を感じられる最小単位（Vertical Slice）で段階的に実装するためのロードマップです。

## Step 1: Walking Skeleton（歩く骸骨）

**目的:** 最もシンプルな状態で「表示して、操作して、保存される」パイプラインを貫通させる。アニメーションやデザインは無視する。

- **User Story:** ユーザーとして、Inboxにあるリンクを1つ処理して、DB上のステータスを変更したい。
- **実装タスク:**
  - [ ] **[API]** Inbox (`status = 'inbox'`) のリンクを取得する `fetchInboxLinks` を実装。
  - [ ] **[API, hooks]** ステータスを更新する `updateLinkStatus` を実装。
  - [ ] **[UI]** テキストのみのシンプルなカードを表示するコンポーネントを作成。
  - [ ] **[Action]** 左右のボタンを配置し、「Right」で `read_soon`、「Left」で `later` にDB更新する処理を接続。
- **完了条件 (AC):**
  - ボタンを押すと画面からカードが消える。
  - Supabase上で該当レコードのステータス変更が確認できる。

## Step 2: The Physics & Gestures（物理挙動の実装）

**目的:** `react-native-gesture-handler` と `reanimated` を導入し、指に追従する「スワイプ操作」を確立する。

- **User Story:** ユーザーとして、カードを指で動かして、直感的に左右に振り分けたい。
- **実装タスク:**
  - [ ] **[UI]** `PanGestureHandler` を導入し、ドラッグ量 (`translationX`, `translationY`) に応じてカードを移動させる。
  - [ ] **[Logic]** スワイプの閾値判定ロジック（画面幅の30%以上でトリガー）を実装。
  - [ ] **[UI]** 手を離した時のアニメーション実装（閾値未満ならSpring Back、以上なら画面外へFly Out）。
  - [ ] **[Integration]** Step 1のAPI呼び出しを、スワイプ完了（Fly Out後）のイベントに接続。
- **完了条件 (AC):**
  - カードを指でドラッグできる。
  - 右に深くスワイプして離すと、カードが右に消え、DBが `read_soon` に更新される。
  - 中途半端な位置で離すと、中央に戻る。

## Step 3: Visual Feedback & The "Up" Swipe（視覚フィードバックと完了アクション）

**目的:** ユーザーに「判断の結果」を視覚的に伝え、3方向目の「完了（Up）」を追加する。

- **User Story:** ユーザーとして、スワイプ中に「今どの操作をしようとしているか」を色やアイコンで理解し、既読リンクは上に飛ばして完了させたい。
- **実装タスク:**
  - [ ] **[UI]** `interpolate` を使用し、ドラッグ位置に応じた背景色変化（右:緑、左:黄）を実装。
  - [ ] **[UI]** スワイプ量に応じて出現するアイコン（Check, Clock, etc.）のアニメーションを実装。
  - [ ] **[Logic]** 上方向（Up Swipe）の検知ロジックと閾値（画面高さの25%）を追加。
  - [ ] **[DB]** Up Swipe時のアクションとして `status = 'completed'` への更新処理を追加。
- **完了条件 (AC):**
  - ドラッグ中に背景色が滑らかに変化する。
  - 上にスワイプすると、特別なエフェクト（例: 金色）と共に `completed` ステータスになる。

## Step 4: The Stack & Real Content（スタック表示と実データ）

**目的:** 複数のリンクを連続処理できる「スタックUI」と、URLからリッチな情報を表示する「OGP」を統合する。

- **User Story:** ユーザーとして、リンクのタイトルやサムネイルを見て判断し、次々と連続で処理したい。
- **実装タスク:**
  - [ ] **[UI]** カードスタック（Top, Next, Queuedの3枚構成）を実装。
  - [ ] **[UI]** 1枚目が消えた際に、2枚目が1枚目の位置へ昇格するSpring Animationを実装。
  - [ ] **[Backend/Edge]** URLからOGP（Title, Image）を取得・保存する仕組み（Edge Function または クライアント側処理）を統合。
  - [ ] **[UI]** カードデザインをブラッシュアップし、実際のタイトルと画像を表示。
- **完了条件 (AC):**
  - Inboxに複数件データがある状態で、連続スワイプでInbox Zeroにできる。
  - カードに実際のWebサイトの画像とタイトルが表示されている。

## Step 5: Safety & Delight（安全性と心地よさ）

**目的:** 誤操作への対策（Undo/削除）と、完了時の達成感（Inbox Zero）を作り込む。

- **User Story:** ユーザーとして、間違えてスワイプした操作を取り消したり、全ての処理が終わった時に達成感を感じたい。
- **実装タスク:**
  - [ ] **[UI]** カード下部に削除ボタン（ゴミ箱）を配置し、タップ時の削除アニメーションとAPI接続を行う。
  - [ ] **[Logic]** Undo機能（直前の操作スタックを保持し、Revertアクションでカードを復帰させる）を実装。
  - [ ] **[UI]** Haptics（振動フィードバック）を閾値越えとリリース時に組み込む。
  - [ ] **[UI]** 全てのカードを処理し終えた時の "Inbox Zero" 画面（Empty State）を実装。
- **完了条件 (AC):**
  - スワイプ直後に「Undo」を押すと、直前のカードがスタックに戻り、DB状態も元に戻る。
  - 全てのカードがなくなると、「All Caught Up!」画面が表示される。
